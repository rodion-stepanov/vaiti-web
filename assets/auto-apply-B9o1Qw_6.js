import{c as B,r as n,y as F,j as e,z as q,A as z,P as w,E as H,F as G,J as V,K as J,o as P,H as d,B as N,M as K,v as _}from"./index-Brt60DIX.js";import{C as A,a as T,b as M,c as U,d as I}from"./card-CXg2H6er.js";import{S as Q}from"./search-filters-CmSmCxua.js";import"./input-COjojgZ4.js";import"./label-TzvMZCRp.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],X=B("calendar-clock",W);var S="Collapsible",[Y,de]=q(S),[Z,R]=Y(S),D=n.forwardRef((s,l)=>{const{__scopeCollapsible:c,open:o,defaultOpen:a,disabled:p,onOpenChange:m,...x}=s,[f,u]=F({prop:o,defaultProp:a??!1,onChange:m,caller:S});return e.jsx(Z,{scope:c,disabled:p,contentId:z(),open:f,onOpenToggle:n.useCallback(()=>u(C=>!C),[u]),children:e.jsx(w.div,{"data-state":E(f),"data-disabled":p?"":void 0,...x,ref:l})})});D.displayName=S;var O="CollapsibleTrigger",$=n.forwardRef((s,l)=>{const{__scopeCollapsible:c,...o}=s,a=R(O,c);return e.jsx(w.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":E(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...o,ref:l,onClick:H(s.onClick,a.onOpenToggle)})});$.displayName=O;var k="CollapsibleContent",L=n.forwardRef((s,l)=>{const{forceMount:c,...o}=s,a=R(k,s.__scopeCollapsible);return e.jsx(G,{present:c||a.open,children:({present:p})=>e.jsx(ee,{...o,ref:l,present:p})})});L.displayName=k;var ee=n.forwardRef((s,l)=>{const{__scopeCollapsible:c,present:o,children:a,...p}=s,m=R(k,c),[x,f]=n.useState(o),u=n.useRef(null),C=V(l,u),j=n.useRef(0),v=j.current,y=n.useRef(0),t=y.current,r=m.open||x,h=n.useRef(r),b=n.useRef(void 0);return n.useEffect(()=>{const i=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(i)},[]),J(()=>{const i=u.current;if(i){b.current=b.current||{transitionDuration:i.style.transitionDuration,animationName:i.style.animationName},i.style.transitionDuration="0s",i.style.animationName="none";const g=i.getBoundingClientRect();j.current=g.height,y.current=g.width,h.current||(i.style.transitionDuration=b.current.transitionDuration,i.style.animationName=b.current.animationName),f(o)}},[m.open,o]),e.jsx(w.div,{"data-state":E(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!r,...p,ref:C,style:{"--radix-collapsible-content-height":v?`${v}px`:void 0,"--radix-collapsible-content-width":t?`${t}px`:void 0,...s.style},children:r&&a})});function E(s){return s?"open":"closed"}var te=D;function se({...s}){return e.jsx(te,{"data-slot":"collapsible",...s})}function ae({...s}){return e.jsx($,{"data-slot":"collapsible-trigger",...s})}function ne({...s}){return e.jsx(L,{"data-slot":"collapsible-content",...s})}const pe=()=>{const{applyToVacancies:s,isApplying:l,applySuccessMessage:c,error:o,selectedResumeId:a,schedulers:p,isLoadingSchedulers:m,fetchSchedulers:x,deleteScheduler:f,schedulerError:u,toggleScheduler:C}=P(),j=async t=>{try{await _.post("/v1/scheduler/auto",{...t.params,enabled:!t.enabled,enabledSchedule:!t.enabled}),C(t.id),d.success(`Автоотклик ${t.enabled?"деактивирован":"активирован"}`)}catch(r){console.error("Failed to toggle scheduler:",r),d.error("Не удалось изменить статус автоотклика")}},v=()=>{if(!a){d.error("Пожалуйста, выберите резюме.");return}s()};n.useEffect(()=>{c&&d.success(c),o&&d.error(o,{description:"Возможно, ваше резюме не соответствует требованиям вакансии, или на стороне hh.ru возникли проблемы."})},[c,o]);const y=async()=>{const t=prompt("Пожалуйста, введите имя для нового автоотклика:");if(!t){d.info("Создание автоотклика отменено.");return}if(!a){d.error("Пожалуйста, выберите резюме.");return}const{filters:r}=P.getState(),{keywordsToExclude:h,...b}=r,i={nameRequest:t,resume_id:a,enabledSchedule:!0,...b,keywordsToExclude:h?.split(",").map(g=>g.trim()).filter(Boolean)||[]};try{await _.post("/v1/scheduler/auto",i),d.success(`Автоотклик "${t}" успешно создан!`),x()}catch(g){console.error("Error creating scheduler:",g),d.error("Не удалось создать автоотклик.")}};return n.useEffect(()=>{x()},[x]),n.useEffect(()=>{u&&d.error(u)},[u]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(A,{children:[e.jsxs(T,{children:[e.jsx(M,{children:"Сервис автооткликов"}),e.jsx(U,{children:"Настройте фильтры, выберите резюме, и мы будем автоматически откликаться на подходящие вакансии."})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsx(Q,{layout:"horizontal",showSubmitButton:!1}),e.jsx(N,{className:"w-full md:w-auto",onClick:v,disabled:l||!a,children:l?"Откликаемся...":"Откликнуться"}),e.jsx(N,{className:"ml-12 w-full md:w-auto",onClick:y,disabled:l||!a,children:l?"Создание...":"Создать автоотклик"})]})]}),p.length>0&&e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(M,{children:"Созданные автоотклики"})}),e.jsx(I,{className:"space-y-4",children:m?e.jsx("p",{className:"text-muted-foreground text-center",children:"Загрузка расписаний..."}):p.map(t=>e.jsxs(se,{className:"mb-2 rounded-lg border",children:[e.jsxs(ae,{className:"hover:bg-accent/50 flex w-full items-center justify-between rounded-md p-4 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"text-primary h-5 w-5"}),e.jsx("span",{className:"font-medium",children:t.name||`Расписание #${t.id}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${t.enabled?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,children:t.enabled?"Активно":"Неактивно"}),e.jsx(K,{className:"text-muted-foreground h-4 w-4 shrink-0 transition-transform duration-200 data-[state=open]:rotate-180"})]})]}),e.jsx(ne,{children:e.jsxs("div",{className:"px-4 pt-0 pb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm font-medium",children:"Создано"}),e.jsx("p",{children:new Date(t.createdAt).toLocaleDateString("ru-RU")})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm font-medium",children:"Параметры поиска"}),e.jsx("div",{className:"mt-1 grid grid-cols-1 gap-2 text-sm md:grid-cols-2",children:Object.entries(t.params).filter(([,r])=>r!=null&&r!==""&&r!==!1).map(([r,h])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[r,": "]}),String(h)]},r))})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>f(t.id),children:"Удалить"}),e.jsx(N,{variant:"outline",size:"sm",className:"text-primary hover:text-primary",onClick:()=>j(t),children:t.enabled?"Деактивировать":"Активировать"})]})]})})]},t.id))})]})]})};export{pe as component};
